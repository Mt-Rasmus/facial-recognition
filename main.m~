%% main
clc;
clear;
close all;

input = imread('images/DB0/db0_2.jpg');
%imshow(input);
%hold on
%title('Original');


%% Gray World Assumption
dim=size(input,3);
input=im2uint8(input);
output=zeros(size(input));    
if (dim==1 || dim==3)
    for j=1:dim
        scalVal=sum(sum(input(:,:,j)))/numel(input(:,:,j));
        output(:,:,j)=input(:,:,j)*(127.5/scalVal);
    end
    output=uint8(output);
else 
    error('myApp:argChk','Input error. Matrix dimensions do not fit.');
end

figure
imshow(output);
title('Color corrected');

%% Face masking

height = size(output,1);
width = size(output,2);

%Initialize the output images
out = output;
bin = zeros(height,width);


%Convert the image from RGB to YCbCr
img_ycbcr = rgb2ycbcr(out);
Cb = img_ycbcr(:,:,2);
Cr = img_ycbcr(:,:,3);

%Detect Skin
[r,c,v] = find(Cb>=77 & Cb<=127 & Cr>=133 & Cr<=173);
numind = size(r,1);

%Mark Skin Pixels
for i=1:numind
    out(r(i),c(i),:) = [0 0 255];
    bin(r(i),c(i)) = 1;
end

%figure; imshow(out);
figure 
imshow(bin)
title('Binary face mask without morphing')

%% Opening

se1 = strel('line', 20, 0);
se1_2 = strel('square', 16);

openedImg = imopen(img, se1);
openedImg2 = imopen(openedImg, se1_2);

%% Closing

se2 = strel('disk',15);

closedImg = imclose(img, se2);
%figure
%imshowpair(openedImg2,closedImg,'montage')
%title('Opened Image / Closed Image');
